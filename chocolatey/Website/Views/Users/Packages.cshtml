@model ManagePackagesViewModel
@{
    ViewBag.Tab = "Packages";
    Layout = "~/Views/Shared/PackagesLayout.cshtml";
    Bundles.Reference("Content/bootstrap/bootstrap.css");
    Bundles.Reference("Content/style-base.css");
    Bundles.Reference("Scripts");
    Bundles.Reference("Scripts/CookiesNotice");
    Bundles.Reference("Scripts/closeable");
}

<section class="container py-3 py-xl-5">
    <div class="row">
        <div class="col-xl-8 mx-auto">
            <h2 class="text-center text-xl-left mb-3 mb-xl-0">Manage My Packages</h2>
            <hr class="mb-3 mb-xl-5" />
            @if (Model.Packages.Any())
            {
                <div class="row">
                    <div class="col-12">
                        <h3 class="mb-4">
                            Published Packages <i class="icon-question-circle h4" alt="Save" data-toggle="tooltip" data-placement="top" title="These packages are currently published for the world to see."></i>
                        </h3>
                        @PrintPublishedPackages(Model.Packages.Where(p => p.Listed), unlisted: false)
                    </div>
                </div>
                var unlistedPackages = Model.Packages.Where(p => !p.Listed);
                if (unlistedPackages.Any())
                {
                    <hr class="mt-4 mb-3 my-xl-5 border-0" />
                    <div class="row">
                        <div class="col-12">
                            <h3 class="mb-4">
                                Unlisted Packages <i class="icon-question-circle h4" alt="Save" data-toggle="tooltip" data-placement="top" title="These packages are currently unlisted."></i>
                            </h3>
                            @PrintPublishedPackages(unlistedPackages, unlisted: true)
                        </div>
                    </div>
                }
            }
            else
            {
                <div class="row">
                    <div class="col-12">
                        <h3>No Packages!</h3>
                        <p>You don't have any packages. Maybe now is a good time to <a href="@Url.UploadPackage()">upload a package</a>.</p>
                    </div>
                </div>
            }
        </div>
    </div>
</section>
@helper PrintPublishedPackages(IEnumerable<PackageViewModel> packages, bool unlisted)
{
    var totlalDownloads = 0;
    <div class="table-responsive-sm">
        <table class="table table-hover table-striped mb-0">
            <thead class="thead-dark">
                <tr>
                    <th scope="col" class="first actions">Actions</th>
                    <th scope="col">Package</th>
                    <th scope="col">Package ID</th>
                    <th scope="col">Version</th>
                    <th scope="col">Published</th>
                    <th scope="col" class="last">Downloads</th>

                </tr>
            </thead>
            <tbody>
                @foreach (var package in packages)
                {
                    <tr>
                        <td class="actions">
                            @if (unlisted)
                            {
                                <a href="@Url.DeletePackage(package)" title="List Package" class="editPackageLink"><img src="@Links.Content.Images.editIcon_png" alt="List Package" /></a>
                            }
                            else
                            {
                                <a href="@Url.EditPackage(package)" title="Edit" class="editPackageLink"><img src="@Links.Content.Images.editIcon_png" alt="Edit" /></a>
                                <a href="@Url.DeletePackage(package)" title="Delete" class="deletePackageLink"><img src="@Links.Content.Images.trash_png" alt="Delete" /></a>
                            }
                        </td>
                        <td>
                            <a href="@Url.Package(package)" title="View package page.">@package.Title</a>
                        </td>
                        <td>@package.Id</td>
                        <td>@package.Version</td>
                        <td>@package.PublishedDate.ToShortDateString()</td>
                        <td>@package.DownloadCount</td>
                    </tr>
                    totlalDownloads += package.DownloadCount;
                }
            </tbody>
            <tfoot>
                <tr class="border-bottom">
                    <td colspan="5" class="h4">
                        You have a total of @packages.Count() packages.
                    </td>
                    <td class="total h4">
                        @totlalDownloads
                    </td>
                </tr>
            </tfoot>
        </table>
    </div>
    }